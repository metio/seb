<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://gohugo.io/" version="0.128.0">Hugo</generator><title type="html">Perl on Sebastian Ho√ü</title><link href="https://seb.xn--ho-hia.de/tags/perl/" rel="alternate" type="text/html" title="html"/><link href="https://seb.xn--ho-hia.de/tags/perl/index.xml" rel="alternate" type="application/rss+xml" title="rss"/><link href="https://seb.xn--ho-hia.de/tags/perl/atom.xml" rel="self" type="application/atom+xml" title="atom"/><updated>2024-07-01T02:33:53+00:00</updated><id>https://seb.xn--ho-hia.de/tags/perl/</id><entry><title type="html">Makefile Help</title><link href="https://seb.xn--ho-hia.de/posts/makefile-help/?utm_source=atom_feed" rel="alternate" type="text/html"/><id>https://seb.xn--ho-hia.de/posts/makefile-help/</id><published>2020-06-29T00:00:00+00:00</published><updated>2023-01-06T16:22:24+01:00</updated><content type="html"><![CDATA[<p>Use the following <a href="https://www.perl.org/">Perl</a> snippet to automatically generate help output for your <code>Makefile</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">GREEN</span>  <span class="o">:=</span> <span class="k">$(</span>shell tput -Txterm setaf 2<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">WHITE</span>  <span class="o">:=</span> <span class="k">$(</span>shell tput -Txterm setaf 7<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">YELLOW</span> <span class="o">:=</span> <span class="k">$(</span>shell tput -Txterm setaf 3<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">RESET</span>  <span class="o">:=</span> <span class="k">$(</span>shell tput -Txterm sgr0<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">HELP_FUN</span> <span class="o">=</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    %help<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">while</span><span class="o">(</span>&lt;&gt;<span class="o">)</span> <span class="o">{</span> push @<span class="o">{</span><span class="nv">$$</span>help<span class="o">{</span><span class="nv">$$</span><span class="m">2</span> // <span class="s1">&#39;targets&#39;</span><span class="o">}}</span>, <span class="o">[</span><span class="nv">$$</span>1, <span class="nv">$$</span>3<span class="o">]</span> <span class="k">if</span> /^<span class="o">([</span>a-zA-Z<span class="se">\-</span><span class="o">]</span>+<span class="o">)</span><span class="se">\s</span>*:.*<span class="se">\#\#</span><span class="o">(</span>?:@<span class="o">([</span>a-zA-Z<span class="se">\-</span><span class="o">]</span>+<span class="o">))</span>?<span class="se">\s</span><span class="o">(</span>.*<span class="o">)</span><span class="nv">$$</span>/ <span class="o">}</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    print <span class="s2">&#34;usage: make [target]\n\n&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">for</span> <span class="o">(</span>sort keys %help<span class="o">)</span> <span class="o">{</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    print <span class="s2">&#34;</span><span class="si">${</span><span class="nv">WHITE</span><span class="si">}</span><span class="nv">$$</span><span class="s2">_:</span><span class="si">${</span><span class="nv">RESET</span><span class="si">}</span><span class="s2">\n&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">for</span> <span class="o">(</span>@<span class="o">{</span><span class="nv">$$</span>help<span class="o">{</span><span class="nv">$$</span>_<span class="o">}})</span> <span class="o">{</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">$$sep</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span> x <span class="o">(</span><span class="m">32</span> - length <span class="nv">$$</span>_-&gt;<span class="o">[</span>0<span class="o">])</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    print <span class="s2">&#34;  </span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="nv">$$</span><span class="s2">_-&gt;[0]</span><span class="si">${</span><span class="nv">RESET</span><span class="si">}</span><span class="nv">$$</span><span class="s2">sep</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="nv">$$</span><span class="s2">_-&gt;[1]</span><span class="si">${</span><span class="nv">RESET</span><span class="si">}</span><span class="s2">\n&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">}</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    print <span class="s2">&#34;\n&#34;</span><span class="p">;</span> <span class="o">}</span>
</span></span></code></pre></div><p>To use <code>HELP_FUN</code>, add the following <code>help</code> target to the same <code>Makefile</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">.DEFAULT_GOAL</span> <span class="o">:=</span> <span class="nb">help</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">help</span>
</span></span><span class="line"><span class="cl"><span class="nf">help</span><span class="o">:</span> <span class="c">##@other Show this help
</span></span></span><span class="line"><span class="cl"><span class="c"></span>	@perl -e <span class="s1">&#39;$(HELP_FUN)&#39;</span> <span class="k">$(</span>MAKEFILE_LIST<span class="k">)</span>
</span></span></code></pre></div><p>Each target in the <code>Makefile</code> is marked as <a href="https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html">phony</a> to signal that those targets are not actually files that are generated as part of your build process. The optional description of a target can be placed after the <code>##@</code> prefix. The first word represents the group of a target and everything that follows is the description of a target. All targets should be formatted just like the <code>help</code> target:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">compile</span>
</span></span><span class="line"><span class="cl"><span class="nf">compile</span><span class="o">:</span> <span class="c">##@hacking Compile your code
</span></span></span><span class="line"><span class="cl"><span class="c"></span>	&lt;compile some code&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">test</span>
</span></span><span class="line"><span class="cl"><span class="nf">test</span><span class="o">:</span> <span class="c">##@hacking Test your code
</span></span></span><span class="line"><span class="cl"><span class="c"></span>	&lt;<span class="nb">test</span> some code&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">sign</span>-<span class="n">cla</span>
</span></span><span class="line"><span class="cl"><span class="nf">sign-cla</span><span class="o">:</span> <span class="c">##@contrib Sign the contributor license agreement
</span></span></span><span class="line"><span class="cl"><span class="c"></span>	&lt;sign some file&gt;
</span></span></code></pre></div><p>Once in place, you can either use <code>make</code> without any argument to call the <code>help</code> target or use <code>make help</code> to see the generated output:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ make
</span></span><span class="line"><span class="cl">usage: make <span class="o">[</span>target<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">contrib:
</span></span><span class="line"><span class="cl">  sign-cla            Sign the contributor license agreement
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">hacking:
</span></span><span class="line"><span class="cl">  compile             Compile your code
</span></span><span class="line"><span class="cl">  <span class="nb">test</span>                Test your code
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">other:
</span></span><span class="line"><span class="cl">  <span class="nb">help</span>                Show this <span class="nb">help</span>
</span></span></code></pre></div>]]></content><category scheme="https://seb.xn--ho-hia.de/categories/snippet" term="snippet" label="snippet"/><category scheme="https://seb.xn--ho-hia.de/tags/make" term="make" label="make"/><category scheme="https://seb.xn--ho-hia.de/tags/makefile" term="makefile" label="Makefile"/><category scheme="https://seb.xn--ho-hia.de/tags/help" term="help" label="help"/><category scheme="https://seb.xn--ho-hia.de/tags/perl" term="perl" label="perl"/></entry></feed>