<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://gohugo.io/" version="0.128.0">Hugo</generator><title type="html">Make on Sebastian Ho√ü</title><link href="https://seb.xn--ho-hia.de/tags/make/" rel="alternate" type="text/html" title="html"/><link href="https://seb.xn--ho-hia.de/tags/make/index.xml" rel="alternate" type="application/rss+xml" title="rss"/><link href="https://seb.xn--ho-hia.de/tags/make/atom.xml" rel="self" type="application/atom+xml" title="atom"/><updated>2024-07-01T02:33:53+00:00</updated><id>https://seb.xn--ho-hia.de/tags/make/</id><entry><title type="html">Executable READMEs</title><link href="https://seb.xn--ho-hia.de/posts/makefile-readme/?utm_source=atom_feed" rel="alternate" type="text/html"/><link href="https://seb.xn--ho-hia.de/posts/makefile-ignore/?utm_source=atom_feed" rel="related" type="text/html" title="Ignore Exit Codes"/><link href="https://seb.xn--ho-hia.de/posts/makefile-help/?utm_source=atom_feed" rel="related" type="text/html" title="Makefile Help"/><id>https://seb.xn--ho-hia.de/posts/makefile-readme/</id><published>2021-03-08T00:00:00+00:00</published><updated>2023-01-06T16:40:24+01:00</updated><content type="html"><![CDATA[<p><code>README</code> file typically contain information about the project itself, for example how it can be installed/used/build. Most of the time these files contains command line instructions that users/contributors copy and paste into their terminal. Instead of doing that, consider placing a <code>Makefile</code> in the root of your project which contains the exact same instructions. Thanks to <code>make</code>, all your contributors can now use TAB-completion to run any of the pre-defined <code>make</code> targets.</p>
<p>The following example is part of one of my projects, and I certainly don&rsquo;t want to type (or even copy) that all the time:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">release</span>-<span class="n">into</span>-<span class="n">local</span>-<span class="n">nexus</span>
</span></span><span class="line"><span class="cl"><span class="nf">release-into-local-nexus</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	mvn versions:set <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	   -DnewVersion<span class="o">=</span><span class="k">$(</span>TIMESTAMPED_VERSION<span class="k">)</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	   -DgenerateBackupPoms<span class="o">=</span><span class="nb">false</span>
</span></span><span class="line"><span class="cl">	-mvn clean deploy scm:tag <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	   -DpushChanges<span class="o">=</span><span class="nb">false</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	   -DskipLocalStaging<span class="o">=</span><span class="nb">true</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	   -Drelease<span class="o">=</span><span class="nb">local</span>
</span></span><span class="line"><span class="cl">	mvn versions:set <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	   -DnewVersion<span class="o">=</span>9999.99.99-SNAPSHOT <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	   -DgenerateBackupPoms<span class="o">=</span><span class="nb">false</span>
</span></span></code></pre></div><p>With the above target in place, everyone can now do <code>make release-into-local-nexus</code> instead of typing/copying the commands themselves. Thanks to TAB-completion you just have to do <code>make r&lt;TAB&gt;</code> and confirm with <code>&gt;ENTER&gt;</code> to perform a release.</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://www.makeareadme.com/">https://www.makeareadme.com/</a></li>
<li><a href="https://opensource.guide/starting-a-project/#launching-your-own-open-source-project">https://opensource.guide/starting-a-project/#launching-your-own-open-source-project</a></li>
</ul>
]]></content><category scheme="https://seb.xn--ho-hia.de/categories/snippet" term="snippet" label="snippet"/><category scheme="https://seb.xn--ho-hia.de/tags/make" term="make" label="make"/><category scheme="https://seb.xn--ho-hia.de/tags/makefile" term="makefile" label="Makefile"/><category scheme="https://seb.xn--ho-hia.de/tags/readme" term="readme" label="README"/><category scheme="https://seb.xn--ho-hia.de/tags/teamwork" term="teamwork" label="teamwork"/></entry><entry><title type="html">Ignore Exit Codes</title><link href="https://seb.xn--ho-hia.de/posts/makefile-ignore/?utm_source=atom_feed" rel="alternate" type="text/html"/><link href="https://seb.xn--ho-hia.de/posts/makefile-help/?utm_source=atom_feed" rel="related" type="text/html" title="Makefile Help"/><id>https://seb.xn--ho-hia.de/posts/makefile-ignore/</id><published>2021-02-08T00:00:00+00:00</published><updated>2023-01-06T16:40:24+01:00</updated><content type="html"><![CDATA[<p>In case you are using a <code>Makefile</code> to define a complex build step - for example start database, run tests, stop database - consider using the <code>-</code> qualifier in front of your actual build step like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">build</span>
</span></span><span class="line"><span class="cl"><span class="nf">build</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	start-database
</span></span><span class="line"><span class="cl">	-build-software
</span></span><span class="line"><span class="cl">	stop-database
</span></span></code></pre></div><p>Thanks to <code>-</code>, the database will be stopped even if building your software fails, therefore making sure to clean up after ourselves once the build finishes.</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Recipe-Echoing">https://www.gnu.org/software/make/manual/make.html#Recipe-Echoing</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#Errors-in-Recipes">https://www.gnu.org/software/make/manual/make.html#Errors-in-Recipes</a></li>
<li><a href="https://www.gnu.org/software/make/manual/make.html#How-the-MAKE-Variable-Works">https://www.gnu.org/software/make/manual/make.html#How-the-MAKE-Variable-Works</a></li>
</ul>
]]></content><category scheme="https://seb.xn--ho-hia.de/categories/snippet" term="snippet" label="snippet"/><category scheme="https://seb.xn--ho-hia.de/tags/make" term="make" label="make"/><category scheme="https://seb.xn--ho-hia.de/tags/makefile" term="makefile" label="Makefile"/><category scheme="https://seb.xn--ho-hia.de/tags/exit-code" term="exit-code" label="exit code"/></entry><entry><title type="html">Makefile Help</title><link href="https://seb.xn--ho-hia.de/posts/makefile-help/?utm_source=atom_feed" rel="alternate" type="text/html"/><id>https://seb.xn--ho-hia.de/posts/makefile-help/</id><published>2020-06-29T00:00:00+00:00</published><updated>2023-01-06T16:22:24+01:00</updated><content type="html"><![CDATA[<p>Use the following <a href="https://www.perl.org/">Perl</a> snippet to automatically generate help output for your <code>Makefile</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">GREEN</span>  <span class="o">:=</span> <span class="k">$(</span>shell tput -Txterm setaf 2<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">WHITE</span>  <span class="o">:=</span> <span class="k">$(</span>shell tput -Txterm setaf 7<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">YELLOW</span> <span class="o">:=</span> <span class="k">$(</span>shell tput -Txterm setaf 3<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">RESET</span>  <span class="o">:=</span> <span class="k">$(</span>shell tput -Txterm sgr0<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">HELP_FUN</span> <span class="o">=</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    %help<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">while</span><span class="o">(</span>&lt;&gt;<span class="o">)</span> <span class="o">{</span> push @<span class="o">{</span><span class="nv">$$</span>help<span class="o">{</span><span class="nv">$$</span><span class="m">2</span> // <span class="s1">&#39;targets&#39;</span><span class="o">}}</span>, <span class="o">[</span><span class="nv">$$</span>1, <span class="nv">$$</span>3<span class="o">]</span> <span class="k">if</span> /^<span class="o">([</span>a-zA-Z<span class="se">\-</span><span class="o">]</span>+<span class="o">)</span><span class="se">\s</span>*:.*<span class="se">\#\#</span><span class="o">(</span>?:@<span class="o">([</span>a-zA-Z<span class="se">\-</span><span class="o">]</span>+<span class="o">))</span>?<span class="se">\s</span><span class="o">(</span>.*<span class="o">)</span><span class="nv">$$</span>/ <span class="o">}</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    print <span class="s2">&#34;usage: make [target]\n\n&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">for</span> <span class="o">(</span>sort keys %help<span class="o">)</span> <span class="o">{</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    print <span class="s2">&#34;</span><span class="si">${</span><span class="nv">WHITE</span><span class="si">}</span><span class="nv">$$</span><span class="s2">_:</span><span class="si">${</span><span class="nv">RESET</span><span class="si">}</span><span class="s2">\n&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">for</span> <span class="o">(</span>@<span class="o">{</span><span class="nv">$$</span>help<span class="o">{</span><span class="nv">$$</span>_<span class="o">}})</span> <span class="o">{</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">$$sep</span> <span class="o">=</span> <span class="s2">&#34; &#34;</span> x <span class="o">(</span><span class="m">32</span> - length <span class="nv">$$</span>_-&gt;<span class="o">[</span>0<span class="o">])</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    print <span class="s2">&#34;  </span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="nv">$$</span><span class="s2">_-&gt;[0]</span><span class="si">${</span><span class="nv">RESET</span><span class="si">}</span><span class="nv">$$</span><span class="s2">sep</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="nv">$$</span><span class="s2">_-&gt;[1]</span><span class="si">${</span><span class="nv">RESET</span><span class="si">}</span><span class="s2">\n&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">}</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    print <span class="s2">&#34;\n&#34;</span><span class="p">;</span> <span class="o">}</span>
</span></span></code></pre></div><p>To use <code>HELP_FUN</code>, add the following <code>help</code> target to the same <code>Makefile</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nv">.DEFAULT_GOAL</span> <span class="o">:=</span> <span class="nb">help</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">help</span>
</span></span><span class="line"><span class="cl"><span class="nf">help</span><span class="o">:</span> <span class="c">##@other Show this help
</span></span></span><span class="line"><span class="cl"><span class="c"></span>	@perl -e <span class="s1">&#39;$(HELP_FUN)&#39;</span> <span class="k">$(</span>MAKEFILE_LIST<span class="k">)</span>
</span></span></code></pre></div><p>Each target in the <code>Makefile</code> is marked as <a href="https://www.gnu.org/software/make/manual/html_node/Phony-Targets.html">phony</a> to signal that those targets are not actually files that are generated as part of your build process. The optional description of a target can be placed after the <code>##@</code> prefix. The first word represents the group of a target and everything that follows is the description of a target. All targets should be formatted just like the <code>help</code> target:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">compile</span>
</span></span><span class="line"><span class="cl"><span class="nf">compile</span><span class="o">:</span> <span class="c">##@hacking Compile your code
</span></span></span><span class="line"><span class="cl"><span class="c"></span>	&lt;compile some code&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">test</span>
</span></span><span class="line"><span class="cl"><span class="nf">test</span><span class="o">:</span> <span class="c">##@hacking Test your code
</span></span></span><span class="line"><span class="cl"><span class="c"></span>	&lt;<span class="nb">test</span> some code&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">.PHONY</span><span class="o">:</span> <span class="n">sign</span>-<span class="n">cla</span>
</span></span><span class="line"><span class="cl"><span class="nf">sign-cla</span><span class="o">:</span> <span class="c">##@contrib Sign the contributor license agreement
</span></span></span><span class="line"><span class="cl"><span class="c"></span>	&lt;sign some file&gt;
</span></span></code></pre></div><p>Once in place, you can either use <code>make</code> without any argument to call the <code>help</code> target or use <code>make help</code> to see the generated output:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ make
</span></span><span class="line"><span class="cl">usage: make <span class="o">[</span>target<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">contrib:
</span></span><span class="line"><span class="cl">  sign-cla            Sign the contributor license agreement
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">hacking:
</span></span><span class="line"><span class="cl">  compile             Compile your code
</span></span><span class="line"><span class="cl">  <span class="nb">test</span>                Test your code
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">other:
</span></span><span class="line"><span class="cl">  <span class="nb">help</span>                Show this <span class="nb">help</span>
</span></span></code></pre></div>]]></content><category scheme="https://seb.xn--ho-hia.de/categories/snippet" term="snippet" label="snippet"/><category scheme="https://seb.xn--ho-hia.de/tags/make" term="make" label="make"/><category scheme="https://seb.xn--ho-hia.de/tags/makefile" term="makefile" label="Makefile"/><category scheme="https://seb.xn--ho-hia.de/tags/help" term="help" label="help"/><category scheme="https://seb.xn--ho-hia.de/tags/perl" term="perl" label="perl"/></entry></feed>