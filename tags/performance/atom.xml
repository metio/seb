<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://gohugo.io/" version="0.128.0">Hugo</generator><title type="html">Performance on Sebastian Ho√ü</title><link href="https://seb.xn--ho-hia.de/tags/performance/" rel="alternate" type="text/html" title="html"/><link href="https://seb.xn--ho-hia.de/tags/performance/index.xml" rel="alternate" type="application/rss+xml" title="rss"/><link href="https://seb.xn--ho-hia.de/tags/performance/atom.xml" rel="self" type="application/atom+xml" title="atom"/><updated>2024-07-01T02:33:53+00:00</updated><id>https://seb.xn--ho-hia.de/tags/performance/</id><entry><title type="html">chezmoi &amp; shell init scripts</title><link href="https://seb.xn--ho-hia.de/posts/shell-init/?utm_source=atom_feed" rel="alternate" type="text/html"/><link href="https://seb.xn--ho-hia.de/posts/chezmoi-maintenance/?utm_source=atom_feed" rel="related" type="text/html" title="Maintaining dotfiles with chezmoi"/><link href="https://seb.xn--ho-hia.de/posts/chezmoi-gpg/?utm_source=atom_feed" rel="related" type="text/html" title="Encrypt dotfiles with chezmoi"/><link href="https://seb.xn--ho-hia.de/posts/chezmoi-auto-git/?utm_source=atom_feed" rel="related" type="text/html" title="Manage dotfiles with chezmoi and git"/><link href="https://seb.xn--ho-hia.de/posts/nvim-plugin-auto-updates/?utm_source=atom_feed" rel="related" type="text/html" title="Automatically update plugins for vim/nvim"/><link href="https://seb.xn--ho-hia.de/posts/xdg-dot-files/?utm_source=atom_feed" rel="related" type="text/html" title="XDG Base Directory Specification"/><id>https://seb.xn--ho-hia.de/posts/shell-init/</id><published>2022-12-12T00:00:00+00:00</published><updated>2023-01-06T16:40:24+01:00</updated><content type="html"><![CDATA[<p>Many CLI applications offer initialization scripts to integrate into a shell, for example <code>starship init zsh</code> or <code>zoxide init zsh</code>. The documentation of these tools usually tell you to put something like <code>eval &quot;$(starship init zsh)&quot;</code> into your shell RC file. While this approach works fine, it does decrease startup speed of your shell because it needs to run the <code>init</code> command every time you open a new shell. Given that you open shells much more often than new versions of these tools are released and installed, you can cache the output of these commands to get a bit of speed back.</p>
<p><a href="https://chezmoi.io/">chezmoi</a> provides a template function called <a href="https://www.chezmoi.io/reference/templates/functions/output/">output</a> which replaces itself with the output of the command you specified. You can use that function this to integrate various tools into your shell as the following example shows while using <code>zsh</code>:</p>
<ol>
<li>Create a directory that holds all init scripts for every tool you want to use.
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> $ mkdir --parents <span class="s2">&#34;</span><span class="si">${</span><span class="nv">ZDOTDIR</span><span class="si">}</span><span class="s2">&#34;</span>/tools.d
</span></span></code></pre></div></li>
<li>Let your shell load all available scripts in that directory. This snippet should be part of your <code>.zshrc</code> file:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">for</span> init_script in <span class="s2">&#34;</span><span class="si">${</span><span class="nv">ZDOTDIR</span><span class="si">}</span><span class="s2">&#34;</span>/tools.d/*.sh<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  <span class="nb">source</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">init_script</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></div></li>
<li>Create chezmoi <code>.tmpl</code> files for each tool and place them in the chezmoi source directory that matches the directory you created in step 1:
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go-text-template" data-lang="go-text-template"><span class="line"><span class="cl"><span class="cp">{{</span><span class="w"> </span><span class="nx">output</span><span class="w"> </span><span class="s">&#34;starship&#34;</span><span class="w"> </span><span class="s">&#34;init&#34;</span><span class="w"> </span><span class="s">&#34;zsh&#34;</span><span class="w"> </span><span class="s">&#34;--print-full-init&#34;</span><span class="w"> </span><span class="cp">}}</span><span class="x">
</span></span></span></code></pre></div></li>
<li>Call <code>chezmoi apply</code> to generate the init scripts.</li>
</ol>
<p>The only downside here is that you have to re-run <code>chezmoi apply</code> after updating one of the tools because they change their init scripts sometimes. That problem can be solved with <a href="../chezmoi-auto-update">chezmoi auto-updates</a>.</p>
]]></content><category scheme="https://seb.xn--ho-hia.de/categories/snippet" term="snippet" label="snippet"/><category scheme="https://seb.xn--ho-hia.de/tags/chezmoi" term="chezmoi" label="chezmoi"/><category scheme="https://seb.xn--ho-hia.de/tags/dotfiles" term="dotfiles" label="dotfiles"/><category scheme="https://seb.xn--ho-hia.de/tags/shell" term="shell" label="shell"/><category scheme="https://seb.xn--ho-hia.de/tags/performance" term="performance" label="performance"/></entry></feed>