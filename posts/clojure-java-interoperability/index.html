<!doctype html><html lang=en><head><meta charset=utf-8><meta name=author content="Sebastian Hoß"><meta name=subject content="Sebastian Hoß"><meta name=description content="articles about software engineering"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:url" content="https://seb.xn--ho-hia.de/posts/clojure-java-interoperability/"><meta property="og:site_name" content="Sebastian Hoß"><meta property="og:title" content="Clojure Java Interoperability"><meta property="og:description" content="Clojure has several forms and macros to call Java code. However, calling Clojure code from Java is not always so straightforward. The following post shows the different options currently available.
Using gen-class Clojure code can be compiled to standard JVM bytecode using gen-class.
Adding static modifiers Clojure imposes the concept of immutability. As such Clojure functions are/should be void of any state or side effects and only operate on the given input."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-29T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-06T17:32:06+01:00"><meta property="article:tag" content="Clojure"><meta property="article:tag" content="Java"><meta property="article:tag" content="Interoperability"><meta name=twitter:card content="summary"><meta name=twitter:title content="Clojure Java Interoperability"><meta name=twitter:description content="Clojure has several forms and macros to call Java code. However, calling Clojure code from Java is not always so straightforward. The following post shows the different options currently available.
Using gen-class Clojure code can be compiled to standard JVM bytecode using gen-class.
Adding static modifiers Clojure imposes the concept of immutability. As such Clojure functions are/should be void of any state or side effects and only operate on the given input."><meta itemprop=name content="Clojure Java Interoperability"><meta itemprop=description content="Clojure has several forms and macros to call Java code. However, calling Clojure code from Java is not always so straightforward. The following post shows the different options currently available.
Using gen-class Clojure code can be compiled to standard JVM bytecode using gen-class.
Adding static modifiers Clojure imposes the concept of immutability. As such Clojure functions are/should be void of any state or side effects and only operate on the given input."><meta itemprop=datePublished content="2022-01-29T00:00:00+00:00"><meta itemprop=dateModified content="2023-01-06T17:32:06+01:00"><meta itemprop=wordCount content="819"><meta itemprop=keywords content="Clojure,Java,Interoperability"><link rel="shortcut icon" href=/favicon.ico><link rel=icon type=image/png href=/favicon-128.png sizes=128x128><link rel=apple-touch-icon type=image/png href=/favicon-128.png sizes=128x128><link rel=canonical href=https://seb.xn--ho-hia.de/posts/clojure-java-interoperability/><link rel=alternate type=application/atom+xml href=https://seb.xn--ho-hia.de/atom.xml title="Sebastian Hoß Atom"><link rel=alternate type=application/rss+xml href=https://seb.xn--ho-hia.de/index.xml title="Sebastian Hoß RSS"><link rel=sitemap type=application/xml href=https://seb.xn--ho-hia.de/sitemap.xml title="Sebastian Hoß Sitemap"><link rel=author type=text/plain href=https://seb.xn--ho-hia.de/humans.txt><link rel=alternate type=application/rdf+xml href=https://seb.xn--ho-hia.de/foaf.rdf title=FOAF><link rel=license href=https://creativecommons.org/publicdomain/zero/1.0/><link href=https://seb.xn--ho-hia.de/css/mobile.min.e14dc54fd7b9d2dea52a0580221a956079e9f0dbb1583eb2c3f19ab416911abcc496c1a81fe403d98380b4105b9a64ccddc0f3182b6174274a173e9dcd5c7c83.css integrity="sha512-4U3FT9e50t6lKgWAIhqVYHnp8NuxWD6yw/GatBaRGrzElsGoH+QD2YOAtBBbmmTM3cDzGCthdCdKFz6dzVx8gw==" media="screen and (max-width: 800px)" rel=stylesheet><link href=https://seb.xn--ho-hia.de/css/tablet.min.8aba29eb35692e2677e7c26e41408d9ed27ed94e71fe6634ad016f9e91a712f9e1c53317bdaf09aff9d1acc503c9dca0b3c3dc5d3a5f4c287d7ebd48eef1640a.css integrity="sha512-irop6zVpLiZ358JuQUCNntJ+2U5x/mY0rQFvnpGnEvnhxTMXva8Jr/nRrMUDydygs8PcXTpfTCh9fr1I7vFkCg==" media="screen and (min-width: 801px) and (max-width: 1199px)" rel=stylesheet><link href=https://seb.xn--ho-hia.de/css/desktop.min.5d7960c466db691c7fe9df667675aa312241bb90e879e462f75e2502350908820cf7477e12664f246157a8a37449baa5b2923035845e419b20b1cfdb177a0de8.css integrity="sha512-XXlgxGbbaRx/6d9mdnWqMSJBu5DoeeRi914lAjUJCIIM90d+EmZPJGFXqKN0SbqlspIwNYReQZsgsc/bF3oN6A==" media="screen and (min-width: 1200px)" rel=stylesheet><link href=https://seb.xn--ho-hia.de/css/darkmode.min.2a5ba1ebf79d23ac725522a486af2ffebf831a4a634fc1471a4b0007daa25afb4417f20dc4cf0e2c1eeb8eb704183160ff9aaf84e060180993fe1e010ac6907f.css integrity="sha512-Kluh6/edI6xyVSKkhq8v/r+DGkpjT8FHGksAB9qiWvtEF/INxM8OLB7rjrcEGDFg/5qvhOBgGAmT/h4BCsaQfw==" media="screen and (prefers-color-scheme: dark)" rel=stylesheet><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebSite","name":"Sebastian Hoß","url":"https:\/\/seb.xn--ho-hia.de\/","description":"articles about software engineering","license":"Creative Commons Zero v1.0 Universal","author":{"@type":"Person","name":"Sebastian Hoß","url":"https:\/\/seb.xn--ho-hia.de\/"},"creator":{"@type":"Person","name":"Sebastian Hoß","url":"https:\/\/seb.xn--ho-hia.de\/"},"accountablePerson":{"@type":"Person","name":"Sebastian Hoß","url":"https:\/\/seb.xn--ho-hia.de\/"},"publisher":{"@type":"Person","name":"Sebastian Hoß","url":"https:\/\/seb.xn--ho-hia.de\/"},"copyrightHolder":{"@type":"Person","name":"Sebastian Hoß","url":"https:\/\/seb.xn--ho-hia.de\/"}}</script><script type=application/ld+json>{"@context":"https://schema.org/","@type":"Person","name":"Sebastian Hoß","email":"seb@xn--ho-hia.de","url":"https:\/\/seb.xn--ho-hia.de\/"}</script><title>Sebastian Hoß &ndash; Clojure Java Interoperability</title></head><body id=site><header id=header><h1 id=projectname><a id=rootlink href=https://seb.xn--ho-hia.de/>Sebastian Hoß</a>
<a href=https://seb.xn--ho-hia.de/sitemap/ title="show me all pages" id=sitemaplink><img class=svgimg src=https://seb.xn--ho-hia.de/images/sitemap.svg alt=sitemap width=30 height=30></a></h1><span id=actions><a href=https://matrix.to/#/%40sebhoss%3amatrix.org id=matrix title="lets talk"><img class=svgimg src=https://seb.xn--ho-hia.de/images/matrix.svg alt=matrix width=32 height=32>
</a><a href=mailto:seb@xn--ho-hia.de id=email title="i want to write you an email"><img class=svgimg src=https://seb.xn--ho-hia.de/images/email.svg alt=email width=32 height=32>
</a><a rel=me href=https://mastodon.online/@sebhoss id=mastodon title="toot toot toot"><img class=svgimg src=https://seb.xn--ho-hia.de/images/mastodon.svg alt=mastodon width=32 height=32>
</a><a href=https://github.com/sebhoss id=github title="want some code?"><img class=svgimg src=https://seb.xn--ho-hia.de/images/github.svg alt=github width=32 height=32>
</a><a href=https://seb.xn--ho-hia.de/atom.xml id=newsfeed title="get notified about updates"><img class=svgimg src=https://seb.xn--ho-hia.de/images/rss.svg alt=newsfeed width=32 height=32></a></span></header><nav id=navigation><ul><h3 class="mobileonly menutitle">Links</h3><li class=mobileonly><a href=https://seb.xn--ho-hia.de/>Home</a></li><li class=mobileonly><a href=https://matrix.to/#/%40sebhoss%3amatrix.org>Let's talk on Matrix</a></li><li class=mobileonly><a href=mailto:seb@xn--ho-hia.de>Send me an email</a></li><li class=mobileonly><a href=https://mastodon.online/@sebhoss>Get in touch on Mastodon</a></li><li class=mobileonly><a href=https://github.com/sebhoss>See some code at GitHub</a></li><li class=mobileonly><a href=https://seb.xn--ho-hia.de/sitemap/>See all pages at the sitemap</a></li><li class=mobileonly><a href=https://seb.xn--ho-hia.de/atom.xml>Subscribe to the Atom feed</a></li><hr class="mobileonly menudivider"><h3 class="mobile-and-tablet menutitle">Navigation</h3><li><a href=https://seb.xn--ho-hia.de/posts/jspecify/>jspecify</a></li><li><a href=https://seb.xn--ho-hia.de/posts/chezmoi-age/>Using chezmoi with age</a></li><li><a href=https://seb.xn--ho-hia.de/posts/multiple-git-configs/>Multiple Git Configurations</a></li><li><a href=https://seb.xn--ho-hia.de/posts/passage-fuzzy-search/>passage fuzzy search</a></li><li><a href=https://seb.xn--ho-hia.de/posts/chezmoi-auto-update/>chezmoi auto-update</a></li><li><a href=https://seb.xn--ho-hia.de/posts/shell-init/>chezmoi & shell init scripts</a></li><li><a href=https://seb.xn--ho-hia.de/posts/awsenv/>awsenv</a></li><li><a href=https://seb.xn--ho-hia.de/posts/clojure-java-interoperability/ class=active>Clojure Java Interoperability</a></li><li><a href=https://seb.xn--ho-hia.de/posts/declarative-conditional-rendering-in-react/>Declarative conditional rendering in React</a></li><li><a href=https://seb.xn--ho-hia.de/posts/home-network-hostnames/>Proper hostnames in your local network</a></li><li><a href=https://seb.xn--ho-hia.de/posts/nvim-plugin-auto-updates/>Automatically update plugins for vim/nvim</a></li><li><a href=https://seb.xn--ho-hia.de/posts/tmux-tmuxp/>Manage tmux sessions with tmuxp</a></li><li><a href=https://seb.xn--ho-hia.de/posts/maven-cd-versioning/>Continuous Versioning with Maven</a></li><li><a href=https://seb.xn--ho-hia.de/posts/github-maven-packages/>GitHub Packages with Maven</a></li><li><a href=https://seb.xn--ho-hia.de/posts/maven-google-central/>Google Central</a></li></ul></nav><main id=content><h1 class=post-titel><a href=https://seb.xn--ho-hia.de/posts/clojure-java-interoperability/>Clojure Java Interoperability
</a><a href=https://github.com/metio/seb/commits/main/content/clojure-java-interoperability title="View article history"><img src=https://seb.xn--ho-hia.de/images/history.svg alt="View article history" height=16 width=14 class="icon svgimg">
</a><a href=https://github.com/metio/seb/edit/main/content/clojure-java-interoperability title="Edit article"><img src=https://seb.xn--ho-hia.de/images/pencil.svg alt="Edit article" height=16 width=14 class="icon svgimg"></a></h1><div class=subtitle>Published: <time datetime=2022-01-29>January 29, 2022</time>
, Updated: <time datetime=2022-01-29>January 6, 2023</time></div><div class=subtitle>Talks about:
&lt;a class="post-tag post-tag-clojure" href="/tags/clojure">clojure&lt;/a>, &lt;a class="post-tag post-tag-interoperability" href="/tags/interoperability">interoperability&lt;/a>, and &lt;a class="post-tag post-tag-java" href="/tags/java">java&lt;/a></div><div id=post-content><p>Clojure has several <a href=https://clojure.org/java_interop>forms and macros</a> to call Java code. However, calling Clojure code from Java is not always so straightforward. The following post shows the different options currently available.</p><h2 id=using-gen-class>Using <code>gen-class</code></h2><p>Clojure code can be <a href=https://clojure.org/compilation>compiled</a> to standard JVM bytecode using <a href=https://clojure.github.io/clojure/clojure.core-api.html#clojure.core/gen-class>gen-class</a>.</p><h3 id=adding-static-modifiers>Adding static modifiers</h3><p>Clojure imposes the concept of immutability. As such Clojure functions are/should be void of any state or side effects and only operate on the given input. Therefore, exporting Clojure functions as static Java methods makes sense. The following example defines a Clojure function, a corresponding Java-callable function and exports the Java function as a static method in the class <code>com.example.Computation</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-clojure data-lang=clojure><span class=line><span class=cl><span class=p>(</span><span class=kd>ns </span><span class=nv>com.example.computation</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=ss>:gen-class</span>
</span></span><span class=line><span class=cl>    <span class=ss>:name</span> <span class=nv>com.example.Computation</span>
</span></span><span class=line><span class=cl>    <span class=ss>:methods</span> <span class=p>[</span><span class=o>#^</span><span class=p>{</span><span class=ss>:static</span> <span class=nv>true</span><span class=p>}</span> <span class=p>[</span><span class=nv>incrementRange</span> <span class=p>[</span><span class=nv>int</span><span class=p>]</span> <span class=nv>java.util.List</span><span class=p>]]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kd>defn </span><span class=nv>increment-range</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;Creates a sequence of numbers up to max and then increments them.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nv>max</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>map inc </span><span class=p>(</span><span class=nb>take max </span><span class=p>(</span><span class=nf>range</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kd>defn </span><span class=nv>-incrementRange</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;A Java-callable wrapper around the &#39;increment-range&#39; function.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nv>max</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>increment-range</span> <span class=nv>max</span><span class=p>))</span>
</span></span></code></pre></div><p>The Java wrapper has to follow the <a href=https://docs.oracle.com/javase/specs/jls/se17/html/jls-3.html#jls-3.8>standard rules</a> for method names. Therefore <code>increment-range</code> has to be renamed to <code>incrementRange</code> (or some similar name without the &ldquo;-&rdquo; in it). The &ldquo;-&rdquo; prefix for the Java wrapper can be configured inside the <code>:gen-class</code> form and will be removed once <code>gen-class</code> runs. The usage from Java looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.example</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ClojureJavaInteropStatic</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=w> </span><span class=n>incrementedRange</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Computation</span><span class=p>.</span><span class=na>incrementRange</span><span class=p>(</span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=adding-generics>Adding generics</h3><p>The returned list in the above code is raw because the method definition doesn&rsquo;t use generics. To solve this problem declare that the generated class <code>:implements</code> a certain interface that exposes the desired method definition(s). You won&rsquo;t be able to declare your methods as static anymore, but get a generified method for all your Java needs.</p><p>The Java interface:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.example</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>RangeIncrementer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=nf>incrementRange</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>max</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The changed Clojure namespace:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-clojure data-lang=clojure><span class=line><span class=cl><span class=p>(</span><span class=kd>ns </span><span class=nv>com.example.computation</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=ss>:gen-class</span>
</span></span><span class=line><span class=cl>    <span class=ss>:name</span> <span class=nv>com.example.Computation</span>
</span></span><span class=line><span class=cl>    <span class=ss>:implements</span> <span class=p>[</span><span class=nv>com.example.RangeIncrementer</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kd>defn </span><span class=nv>increment-range</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;Creates a sequence of numbers up to max and then increments them.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nv>max</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>map inc </span><span class=p>(</span><span class=nb>take max </span><span class=p>(</span><span class=nf>range</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kd>defn </span><span class=nv>-incrementRange</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;A Java-callable wrapper around the &#39;increment-range&#39; function.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nv>this</span> <span class=nv>max</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>increment-range</span> <span class=nv>max</span><span class=p>))</span>
</span></span></code></pre></div><p>Finally, the generified usage from Java:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.example</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ClojureJavaInteropGenerics</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RangeIncrementer</span><span class=w> </span><span class=n>incrementer</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Computation</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>List</span><span class=o>&lt;</span><span class=n>Long</span><span class=o>&gt;</span><span class=w> </span><span class=n>incrementedRange</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>incrementer</span><span class=p>.</span><span class=na>incrementRange</span><span class=p>(</span><span class=n>10</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>Couple of notes for this as well: First the generated class still only returns the raw type (<code>List</code> instead of <code>List&lt;Integer></code>). So instead of using the class, use the interface for the variable declaration (<code>RangeIncrementer incrementer = ..</code> instead of <code>Computation comp = ..</code>). The interface will return the non-raw <code>List</code>. Second the function definition for <code>-incrementRange</code> is now slightly different. It needs an additional parameter (<code>this</code>) which exposes the current instance to the generated class/method.</p><p>Returning an array of something is also possible with the following construct <code>"[Ljava.lang.Object;"</code>. Need a 2-dim array? Just use <code>"[[Ljava.lang.Object;"</code> (notice the extra <code>[</code>) and so on. However, be aware that the method return types have to match, for example you can&rsquo;t specify a return type of array if your Clojure function does not return an array. In the example above the call to <code>map</code> returns <code>LazySeq</code> which itself is a <code>java.util.List</code>. Therefore, the method declaration is valid, and you won&rsquo;t get any <code>ClassCastException</code> when calling <code>incrementRange</code> from Java.</p><h3 id=make-your-life-easier-with-macros>Make your life easier with macros</h3><p>Instead of defining every Clojure function which should be exported twice (the real function + the Java wrapper), it is possible to use a macro to do that extra work automatically.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-clojure data-lang=clojure><span class=line><span class=cl><span class=p>(</span><span class=nf>require</span> <span class=o>&#39;</span><span class=p>[</span><span class=nv>clojure.string</span> <span class=ss>:as</span> <span class=nv>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kd>defn </span><span class=nv>camel-case</span> <span class=p>[</span><span class=nv>input</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>let </span><span class=p>[</span><span class=nv>words</span> <span class=p>(</span><span class=nf>string/split</span> <span class=nv>input</span> <span class=o>#</span><span class=s>&#34;[\s_-]+&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>string/join</span> <span class=p>(</span><span class=nb>cons </span><span class=p>(</span><span class=nf>string/lower-case</span> <span class=p>(</span><span class=nb>first </span><span class=nv>words</span><span class=p>))</span> <span class=p>(</span><span class=nb>map </span><span class=nv>string/capitalize</span> <span class=p>(</span><span class=nb>rest </span><span class=nv>words</span><span class=p>))))))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kd>defn </span><span class=nv>java-name</span> <span class=p>[</span><span class=nv>clojure-name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>symbol </span><span class=p>(</span><span class=nb>str </span><span class=s>&#34;-&#34;</span> <span class=p>(</span><span class=nf>camel-case</span> <span class=p>(</span><span class=nb>str </span><span class=nv>clojure-name</span><span class=p>)))))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kd>defmacro </span><span class=nv>defn*</span> <span class=p>[</span><span class=nb>name </span><span class=o>&amp;</span> <span class=nv>declarations</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>let </span><span class=p>[</span><span class=nv>java-name</span> <span class=p>(</span><span class=nf>java-name</span> <span class=nv>name</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=o>`</span><span class=p>(</span><span class=k>do </span><span class=p>(</span><span class=kd>defn </span><span class=o>~</span><span class=nb>name </span><span class=o>~</span><span class=nv>declarations</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=kd>defn </span><span class=o>~</span><span class=nv>java-name</span> <span class=o>~</span><span class=nv>declarations</span><span class=p>))))</span>
</span></span></code></pre></div><p>The macro <code>defn*</code> replaces <code>defn</code> and automatically creates a second function with a valid camel-cased Java method name. The macro is available as a <a href=https://github.com/sebhoss/def-clj>small library</a> at <a href="https://search.maven.org/search?q=g:com.github.sebhoss%20a:def-clj">Maven Central</a>. The macro won&rsquo;t add the extra parameter mentioned above to Java wrapper, so it is only useful for declaring static methods.</p><h2 id=using-the-clojure-runtime>Using the Clojure Runtime</h2><p>Using <code>gen-class</code> imposes certain limitations on calling Clojure code from Java. One of those are functions which make use of Clojure <a href=https://clojure.org/reference/special_forms#binding-forms>parameter destructuring</a>. To invoke those functions you have to use the Clojure runtime.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// The Clojure &#39;require&#39; function from the &#39;clojure.core&#39; namespace.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Var</span><span class=w> </span><span class=n>require</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RT</span><span class=p>.</span><span class=na>var</span><span class=p>(</span><span class=s>&#34;clojure.core&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;require&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Your namespace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Symbol</span><span class=w> </span><span class=n>namespace</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Symbol</span><span class=p>.</span><span class=na>intern</span><span class=p>(</span><span class=s>&#34;DESIRED.NAMESPACE.HERE&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Your function</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Var</span><span class=w> </span><span class=n>function</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RT</span><span class=p>.</span><span class=na>var</span><span class=p>(</span><span class=s>&#34;DESIRED.NAMESPACE.HERE&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;DESIRED-FUNCTION&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// The required keyword for the above function</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Keyword</span><span class=w> </span><span class=n>keyword</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Keyword</span><span class=p>.</span><span class=na>intern</span><span class=p>(</span><span class=s>&#34;REQUIRED-KEYWORD&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Require/Import your namespace</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>require</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>namespace</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Invoke your function with the given keyword and its value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Object</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>function</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>keyword</span><span class=p>,</span><span class=w> </span><span class=n>VALUE</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>The desired namespace has to be on the classpath for this to work. Alternatively it is possible to load an entire Clojure script, as shown in the following example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>RT</span><span class=p>.</span><span class=na>loadResourceScript</span><span class=p>(</span><span class=s>&#34;DESIRED/NAMESPACE/HERE.clj&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>RT</span><span class=p>.</span><span class=na>var</span><span class=p>(</span><span class=s>&#34;DESIRED.NAMESPACE.HERE&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;DESIRED-FUNCTION&#34;</span><span class=p>).</span><span class=na>invoke</span><span class=p>(</span><span class=n>PARAMETER</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>On a big project it is properly wise to move Java->Clojure interop code into helper classes/methods. Look <a href=https://github.com/mikera/clojure-utils/blob/master/src/main/java/mikera/cljutils/Clojure.java>here</a> for an example.</p></div><script type=application/ld+json src=jsonld.json></script></main><footer id=footer><p xmlns:dct=http://purl.org/dc/terms/ xmlns:vcard=http://www.w3.org/2001/vcard-rdf/3.0#><a rel=license href=https://creativecommons.org/publicdomain/zero/1.0/><img src=https://seb.xn--ho-hia.de/images/cc0.png style=border-style:none alt=CC0 width=88px height=31px></a><br>To the extent possible under law,
<a rel=dct:publisher href=https://seb.xn--ho-hia.de/><span property="dct:title">Sebastian Hoß</span>
</a>has waived all copyright and related or neighboring rights to
<span property="dct:title">seb.xn--ho-hia.de</span>.
This work is published from:
<span property="vcard:Country" datatype="dct:ISO3166" content="EN" about="https://seb.xn--ho-hia.de/">Germany</span></p></footer></body></html>